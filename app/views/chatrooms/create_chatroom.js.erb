
App.cable.subscriptions.create({channel: "ChatroomsChannel", room: "chatrooms:<%=@chatroom.id%>"}, {
  connected() {
    // Called when the subscription is ready for use on the server
    console.log("connected");
  },
  disconnected() {
    // Called when the subscription has been terminated by the server
    console.log("disconnected");
  },

  received(data) {
    $("#messages_container_" + data.chatroom_id).append(data.message)
  }
}
);
    // Called when there's incoming data on the websocket for this channel


//add the conversation to the chatbox
// App.cable.subscriptions.create
// App.chatrooms
console.log("one");
App.cable.subscriptions.create({channel: "ChatroomsChannel", room:"chatrooms:<%=@chatroom.id%>"},
connected = function() {
  console.log("connected");
},
disconnected = function() {
  console.log("done");
},
disconnected = function() {
  console.log("sup");
});
console.log("two");

// cable.subscriptions.create({channel: "ChatroomsChannel", room: "chatrooms:<%=@chatroom.id%>"},
// received = function(data) {
//     console.log(data)
//     console.log("good")
//     $("#messages_container_#{data.chatroom_id}").append(data.message)
// })
html = '<div class = "chatbox_chat"><button class="chatbox_chat_btn" id="chat<%=@chatroom.id%>" onclick="chatbox_chat_clicked(this)"><%=@chatroom.users[1].username%></button></div>'
$("#chatbox_chat_wrap").append(html);

if (num_open_chats < max_open_chats) {
  num_open_chats += 1;
  $("#chat_wrapper" + num_open_chats).append("<%= escape_javascript("#{render 'layouts/show_chat'}").html_safe%>");
}

//slide all chat windows to the right, starting from the end
// if (num_open_chats < max_open_chats) {
//   for (var i = num_open_chats; i >= 1; i--) {
//     slide_chat(i, i + 1);
//   }
//
//   $("#chat_wrapper1").append("<%= escape_javascript("#{render 'layouts/show_chat'}").html_safe%>");
//
//   num_open_chats += 1
//   // remember to also decrement this when you close a chat window
// }
