
<% if @chatroom != nil %>

  $("#chatbox_chat_wrap").append("<%= escape_javascript("#{render 'chatbox_chat', obj: @chatroom}").html_safe%>");
  <%= render :partial => 'show.js.erb'%>

  App.cable.subscriptions.create({channel: "ChatroomsChannel", room: "chatrooms:<%=@chatroom.id%>"}, {
    connected() {
      // Called when the subscription is ready for use on the server
      console.log("connected");
    },
    disconnected() {
      // Called when the subscription has been terminated by the server
      console.log("disconnected");
    },

    received(data) {
      active_chatroom = $("#messages_container_" + data.chatroom_id)
      active_chatbox_chat = $("#chat" + data.chatroom_id)
      // console.log(active_chatroom.length, active_chatbox_chat.length)

      if (active_chatbox_chat.length == 0) {
        // $.ajax({
        //   url: "chatrooms/add_chatbox_chat",
        //   type: "GET",
        //   dataType:"script",
        //   data: {chatroom_id: data.chatroom_id}
        // });
      }

      else if (active_chatroom.length == 0) {
        // $.ajax({
        //   url: "chatrooms/show_new_message_notification",
        //   type: "GET",
        //   dataType: "script",
        //   data: {chatroom_id, data.chatroom_id}
        // })
      }
      else {
        active_chatroom.append(data.message)
      }
    }
  });

<% end %>
